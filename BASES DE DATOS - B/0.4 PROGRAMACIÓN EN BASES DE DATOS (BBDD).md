Cuando hablamos de programación de BBDD debemos mencionar **PL/SQL**, el lenguaje procedural diseñado para trabajar con **SQL**; además, está incluido con Oracle Database Server. A continuación detallaremos sus principales características:

- Integración con SQL
- Control de errores y excepciones
- Uso de variables
- Estructuras de control de flujo
- Soporte de programación orientada a objetos
- Programación modular: procedimientos y funciones

## 11.1. Entornos de desarrollo en el entorno de las BBDD

Tanto Oracle como MySQL tienen su propio intérprete, que son los siguientes:

- Oracle: Oracle SQL*Plus
- MySQL: MySQL Command Client

## 11.2. Sintaxis del lenguaje de programación

## 11.2.1. Bloques en PL/SQL

Los bloques son la forma más básica de programar en **PL/SQL**.  
Un bloque **se compila y se ejecuta en la base de datos**.  
Los **procedimientos y funciones se guardan como objetos**, mientras que el **bloque anónimo no se guarda**.

Todo bloque PL/SQL tiene tres partes:

- **Parte de declaraciones** (opcional): variables, constantes, cursores y excepciones definidas por el usuario.
- **Parte ejecutable** (obligatoria): sentencias de control y llamadas a funciones o procedimientos.
- **Parte de tratamiento de excepciones** (opcional): manejo de errores.

Ejemplo de cómo se realizan las tres partes:

![[Pasted image 20260121135137.png]]

Un bloque puede ser de tres tipos: función, procedimiento o anónimo; su objetivo es conseguir modularidad; para ello utilizamos procedimientos y funciones.

## Variables en PL/SQL

Las variables se declaran en la parte declarativa de un bloque PL/SQL.  
Sirven para almacenar datos y para pasar información a subprogramas (procedimientos y funciones).

### Modos de parámetros

- IN: dato de entrada (solo lectura).
- OUT: dato de salida.
- IN OUT: dato de entrada y salida.

### Constantes

Son variables cuyo valor no puede cambiar.

### Tipos de variables

- Compuestos: registros, arrays, tablas anidadas.
- LOB: datos grandes como texto, imágenes, audio o vídeo (hasta varios GB).
- Escalar

## Variables en MySQL

En MySQL existen palabras reservadas que no pueden usarse como nombres de variables. Si necesitamos usar una palabra reservada como identificador, debemos encerrarla entre comillas invertidas.  
Ejemplos: `SELECT` (si se usa como identificador, debe escaparse).  
También podemos usar variables de usuario, por ejemplo:  
`SET @minimo = 10000;`

Para usar ese dato en una consulta:  
`SELECT * FROM tabla WHERE cantidad < @minimo;`

## 11.2.3 Operadores

Estos son los operadores que se usan para relacionar y operar datos, por ejemplo:

- - y - : suma y resta
- / : división

Y así con todos los operadores aplicables en estructuras de control.

## 11.3 Procedimientos y funciones

Los procedimientos y las funciones son herramientas de PL/SQL y MySQL para reutilizar código.

Las funciones y los procedimientos tienen dos partes:

- Especificación: nombre del subprograma y tipos de argumentos; si es una función también se indica el valor que retorna.
- Cuerpo: aquí se escriben las sentencias por las que fue creado el procedimiento o la función.

## Procedimientos en PL/SQL

El procedimiento está creado por un conjunto de sentencias que serán ejecutadas cada vez que se invoquen.

Ejemplo: `CREATE [OR REPLACE] PROCEDURE [esquema.] nombre_procedure (nombre_parametro UT|INOUT} tipo_de_dato, …) S}

declaraciones_de_variables; declaraciones_de_constantes; declaraciones_de_cursores;

BEGIN

cuerpo_del_subprograma; [EXCEPTION bloque_de_excepciones;] END; / `

- **CREATE [OR REPLACE] PROCEDURE**: Crea el procedimiento y, si ya existe uno con el mismo nombre, lo reemplaza.
    
- **nombre_procedure**: Nombre que se asigna al procedimiento.
    
- **Parámetro formal**: Variable declarada en la cabecera del procedimiento (IN, OUT, INOUT) que actúa como variable local.
    
- **Parámetro actual**: Valor que se pasa al llamar al procedimiento y que se asigna al parámetro formal.
    

## 11.4. Control de errores

Una excepción es el resultado que se obtiene después de ejecutarse un bloque de PL/SQL que contiene un error.

La capturamos con EXCEPTION y la lanzamos con RAISE.