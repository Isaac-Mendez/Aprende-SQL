## 10.1. Administración de usuarios

Para interactuar con la base de datos se crean usuarios; cada usuario tiene permisos y roles. Podemos tener desde usuarios con todos los permisos hasta usuarios con muchas restricciones. Cada usuario tendrá nombre de usuario, el modelo de autentificación, el perfil de usuario y, en caso de Oracle, será necesario definir el tablespace.

## 10.1.1. Administración de usuarios en Oracle

En Oracle existen varios modos de autentificación de usuario:

- **Autentificación por BD**: Aquí el usuario accede con usuario y contraseña, que se almacenan en la base de datos de forma encriptada; Oracle se encarga de autenticar al usuario.
    
- **Autenticación externa**: La cuenta la mantiene Oracle, pero la autentificación la realiza otro sistema (por ejemplo, el sistema operativo); cuando el usuario se autentica en el sistema operativo, puede acceder a la base de datos.
    
- **Cuentas administrativas**:
    

En Oracle existen varias cuentas con permisos y privilegios por defecto:

- **SYS**: Superadministrador con todos los permisos (rol DBA). No conviene modificarla porque contiene el diccionario de datos.
- **SYSTEM**: Cuenta administrativa con vistas y tablas ya creadas.
- **SYSMAN**: Se usa para tareas administrativas mediante el Enterprise Manager.
- **DBSNMP**: Controlador para Enterprise Manager.

También existen cuentas con muchos permisos; por motivos de seguridad se recomienda segmentar estos roles, ya que podrían ser objetivo de ciberdelincuentes. Entre los roles con más permisos están:

- **SYSTEM**: Tiene control amplio de la base de datos.
- **SYSPER**: Permite realizar tareas básicas pero sin acceso a todos los datos.


Para evitar violaciones se recomienda dividir SYSDBA en roles que hagan cosas específicas. Ejemplo:

- **SYSBACKUP**: Hacer copia de seguridad
- **SYSDG**: Gestión de protección de datos
- **SYSRAC**: Gestión de RAC
- **SYSKM**: Gestión de credenciales

## Características de los usuarios en Oracle

- **Nombre de usuario**: Debe ser único, o sea no se puede repetir; debe tener como máximo 30 caracteres, ser alfanumérico y puede incluir los símbolos $ y _.
    
- **Espacio físico**: Es el espacio que tiene el usuario y que puede utilizar.
    
- **Perfil asociado**: Son los diferentes recursos que se le otorgan.
    
- **Privilegios y roles**: Concesión de las funciones que puede realizar el usuario.
    

## STATUS (estados) de una cuenta de usuario

- **OPEN (Abierto)**: La cuenta está abierta y se puede trabajar sin problemas.
    
- **EXPIRED (Expirada)**: La cuenta está expirada y no se puede entrar.
    
- **EXPIRED GRACE (Expirada en gracia)**: Está expirada pero todavía se puede entrar durante un número de días; si se supera ese periodo y no se actualiza la contraseña, expirará totalmente y no se podrá entrar.
    
- **LOCKED (Bloqueada)**: El administrador del sistema ha bloqueado la cuenta.
    
- **LOCKED TIMED (Bloqueada por un tiempo)**: Después de varios intentos fallidos de iniciar sesión, el sistema bloquea la cuenta por un cierto tiempo.
    
- **EXPIRED & LOCKED (La cuenta está expirada y bloqueada)**: La cuenta ha expirado y se ha bloqueado.
    

## Creación de usuario

Para crear un usuario en Oracle es obligatorio estar conectado con un usuario que tenga privilegios administrativos, como **SYSTEM** o **SYS**.

Una vez conectados, el usuario se crea con el siguiente comando:

`CREATE USER ilerna IDENTIFIED BY root;`

Para comprobar con qué usuario estamos conectados en la sesión actual se utiliza:

`SHOW USER;`


## Borrado de usuario

Para borrar el usuario tenemos que hacerlo de la siguiente manera: `DROP USER nombre_usuario [CASCADE];` El CASCADE se encarga de todos los objetos relacionados con ese usuario.

## Consulta del sistema

Mediante `DESC DBA_USERS;` se muestra la lista de usuarios del sistema y su estructura.

## Espacios en tablas (tablespaces)

Los tablespaces son estructuras de almacenamiento de una BD (tablas, vistas, procedimientos); por defecto Oracle crea los siguientes tablespaces:

- SYSTEM: Diccionario de datos.
- SYSAUX: Componente para opciones de la BD.
- USER

## 10.1.2. Administración de usuarios en MySQL

## Cuentas reservadas

En MySQL hay algunas cuentas predeterminadas o reservadas que vienen por defecto al instalar MySQL. Son las siguientes:

- **ROOT**: Este usuario tiene todos los privilegios; se recomienda cambiar el nombre por motivos de seguridad.
    
- **MYSQL.SYS**: Sirve para definir objetos (vistas, procedimientos, funciones); ayuda a solucionar problemas que pueda tener ROOT.
    
- **MYSQL.SESSION**: Es una cuenta usada internamente por plugins para acceder al servidor.
    

## Privilegios administrativos

- **Privilegios de administrador**: Permiten al usuario realizar acciones en el servidor de MySQL; es decir, puede acceder a cualquier tabla de las bases de datos que gestione el servidor.

## Privilegios de bases de datos

- Son todos los privilegios que atañen a la base de datos, como vistas, procedimientos, funciones, entre otros.

## Privilegios de objetos

Son los privilegios que se aplican al objeto concreto, como rutinas, tablas, etc.

## Creación de usuario

En este apartado es fácil: solo tenemos dos maneras de crear un usuario:

- Por la interfaz.
- Por comandos.

En la parte de interfaz solo hay que darle a agregar usuario; en la parte de comandos solo hay que colocar en la consola: `CREATE USER nombre_usuario IDENTIFIED BY 'password';`

## Modificación de usuario

Para hacer modificaciones usamos el comando **ALTER USER**. Este comando solo lo pueden ejecutar quienes tengan permisos de administrador o quienes puedan hacer **UPDATE**.

Para listar los usuarios y ver qué tipo de permiso tienen utilizamos el siguiente comando: `SELECT USER FROM mysql.user`

También, cuando actualizamos un usuario y no especificamos algún cambio, ese atributo permanecerá como estaba antes.

Ejemplo de cambio de solo contraseña: `ALTER USER 'mrobinson'@'localhost' IDENTIFIED BY 'newpassword456';`

## Borrado de usuario

Para que un usuario pueda borrar a otro debe tener primero permiso para hacerlo; luego, con este comando lo puede eliminar: `DROP USER 'mrobinson'@'localhost';`

Se recuerda que este usuario no se borrará hasta que cierre su sesión.

## 10.2. Administración de privilegios

La administración de privilegios nos permite establecer una jerarquía entre los usuarios y así asegurarnos de que cada uno manipule solo lo suyo.

## 10.2.1. Administración de privilegios en Oracle

Aquí tenemos dos tipos de privilegios:

- **Privilegios de sistema**: Afectan a todos los usuarios de la base de datos; por ejemplo: CREATE USER o CREATE TABLE.
- **Privilegios de objetos**: Como hemos comentado antes, son los que permiten modificar tablas, vistas, procedimientos.

Por otro lado, estos comandos son importantes en la gestión de privilegios:

- **REVOKE**: Quita los privilegios.
- **GRANT**: Asigna privilegios.

También en este apartado veremos las opciones que podemos usar con privilegios mediante la palabra reservada **WITH**; con ella podemos añadir otras opciones, por ejemplo:

Ejemplo de sintaxis: `[WITH option[, opción]]`

- **GRANT OPTION**: Concede a otros usuarios los permisos del primer usuario.
    
- **MAX_QUERIES_PER_HOUR count**: Restringe el número de consultas que puede hacer un usuario por hora.
    
- **MAX_UPDATES_PER_HOUR count**: Restringe el número de actualizaciones que puede hacer un usuario por hora.
    
- **MAX_CONNECTIONS_PER_HOUR count**: Restringe el número de conexiones por hora que puede hacer un usuario.
    
- **MAX_USER_CONNECTIONS count**: Restringe el número de conexiones simultáneas que tiene un usuario.
    

## 10.3. Administración de roles

Los roles son un conjunto de privilegios que se otorgan a los usuarios; esto se hace para facilitar la gestión. Entre las características de los roles y los privilegios tenemos:

- No se pueden otorgar a sí mismos ni de forma circular.
- Poseen contraseña.
- Tienen nombre único.
- No forman parte de ningún esquema.

## Beneficios de los roles

- Se simplifica el otorgar permisos y un rol también puede otorgar permisos.
- Es más dinámico: si se modifica un rol, se modifican todos los usuarios que lo tienen.
- Los roles asignados a un usuario pueden ser activados o desactivados.
- El manejo de roles disminuye el número de GRANT en el diccionario de datos.

Oracle proporciona roles predefinidos para ayudar a la administración de las BBDD. Son los siguientes:

• CONNECT: incluye únicamente el privilegio CREATE SESSION, que permite conectar a la BD. Si el usuario se crea con OEM, este rol se asigna automáticamente.

• RESOURCE: incluye CREATE CLUSTER, CREATE INDEXTYPE, CREATE OPERATOR, CREATE PROCEDURE, CREATE SEQUENCE, CREATE TABLE, CREATE TRIGGER y CREATE TYPE. Además, otorga el privilegio UNLIMITED TABLESPACE.

• DBA: incluye todos los privilegios del sistema mediante la opción WITH ADMIN OPTION.

## 10.4. Administración de perfiles

Los límites son estandarizaciones para poder colocar **límites de recursos** al usuario.

Algunos parámetros que podemos definir sobre los recursos son:

- **SESSIONS_PER_USER**: Se asigna cuántas sesiones puede tener el usuario simultáneamente.
- **CPU_PER_SESSION**: Se determina cuánto tiempo puede usar el usuario la CPU por sesión.
- **CPU_PER_CALL**: Se determina el tiempo límite de CPU para ejecutar una llamada.
- **CONNECT_TIME**: Se determina el tiempo máximo que puede estar una sesión activa.
- **IDLE_TIME**: Determina el tiempo máximo de inactividad de una sesión.
- **LOGICAL_READS_PER_SESSION**: Determina el número máximo de bloques leídos por una sesión.
- **LOGICAL_READS_PER_CALL**: Determina el número máximo de bloques leídos por una llamada.
- **FAILED_LOGIN_ATTEMPTS**: Determina el número de intentos que se pueden hacer para iniciar sesión; el número máximo son 10 intentos.
- **PASSWORD_LIFE_TIME**: Determina el número de días que una contraseña es válida para iniciar sesión; por defecto son 180 días.

## 10.5. Normativa legal vigente sobre la protección de datos

La Ley Orgánica 3/2018, de 5 de diciembre, de Protección de Datos Personales y garantía de los derechos digitales